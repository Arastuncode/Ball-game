<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>
            *{box-sizing: border-box;}
            #game{position: relative;margin: 10vh auto;border:1px solid #666;display: flex;}
            #game > div {position: absolute;}
            #ball{border-radius: 50%;}
            p{color: yellow;font-size:2em;margin:auto;text-align: center}
            #count{color: red;font-size: 2em; position: absolute;top: 5%;right: 25%;}
        </style>
    </head>
    <body>
        <script>
            let body = document.querySelector('body')
            let p = document.createElement('p')
            body.appendChild(p)
            p.id = "count"
            let game ={
                id : 'game',
                elem : null,
                width: 800,
                height: 600,
                create(){
                    document.querySelector("body").innerHTML += `<div id="${this.id}"></div>` 
                    this.show()
                },
                show(){
                    this.elem = document.getElementById(`${this.id}`);
    
                    this.elem.style.width = this.width + 'px'
                    this.elem.style.height = this.height + 'px'
                    this.elem.style.background = 'white'
                },
                over() {
                    this.elem.style.background = 'black'
                    body.style.background = 'black'
                    this.elem.innerHTML += `<p>GAME OVER</p>`
                    clearTimeout(start)
                }     
            }      
            let ball = {
                id : 'ball',
                elem : null,
                width: 30,
                height: 30,
                color : 'red',
                y  : 0,
                x  : 0,
                dy : 5,
                dx : 5,
                create(){
                    game.elem.innerHTML += `<div id="${this.id}"></div>` 
                    this.show()
                },
                move() {
                    if (this.x < 0 || this.x >= game.width - this.width) this.dx *= -1
                    if (this.y < 0 || (this.y + this.height  > bar.y &&
                                       this.x + this.width/2 >= bar.x &&
                                       this.x + this.width/2 <= bar.x + bar.width)) this.dy *= -1
                    if(this.y >= game.height - this.height) game.over()
                    this.x += this.dx
                    this.y += this.dy

                    this.show();
                    bricks.collision();
                },
                show(){
                    this.elem = document.getElementById(`${this.id}`);

                    this.elem.style.width = this.width + 'px'
                    this.elem.style.height = this.height + 'px'
                    this.elem.style.background = this.color
                    this.elem.style.borderRadius = '50%'
                    this.elem.style.top = this.y + 'px'
                    this.elem.style.left = this.x + 'px'
                }
            };
            let bar = {
                id : 'bar',
                elem : null,
                width: 150,
                height: 10,
                color : 'blue',
                y  : 0,
                x  : 0,
                dx : 10,
                create(){
                    game.elem.innerHTML += `<div id="${this.id}"></div>` 
                    this.y = game.height - this.height
                    this.show()
                },
                move(e) {
                    if(e.keyCode == 37 && this.x > 0) this.x -= this.dx
                    if(e.keyCode == 39 && this.x < game.width - this.width) this.x += this.dx
                    this.show()
                },
                show(){
                    this.elem = document.getElementById(`${this.id}`);
                    this.elem.style.width = this.width + 'px'
                    this.elem.style.height = this.height + 'px'
                    this.elem.style.background = this.color
                    this.elem.style.top = this.y + 'px'
                    this.elem.style.left = this.x + 'px'
                }
            }
            let bricks = {
                setir: 4,
                sira: 6,
                gap: 10,
                arr: [],
                count : 0,
                create (){
                    for(let i = 0; i < this.setir; i++){
                        for(let j = 0; j < this.sira; j++){
                            let brick = new function(){
                                this.id = `brick${i}${j}`
                                this.elem = null
                                this.color = "orange"
                                this.width = (game.width - bricks.gap * (bricks.sira + 1)) / bricks.sira 
                                this.height = this.width / 4
                                this.color = this.color
                                this.x = j * this.width + (j + 1) * bricks.gap
                                this.y = i * this.height + (i + 1) * bricks.gap
                            }
                            this.arr.push(brick)
                            game.elem.innerHTML += `<div id="${brick.id}"></div>`
                        }   
                    }
                    bricks.show()
                },
                show(){
                    this.arr.forEach(brick => {
                        brick.elem = document.getElementById(this.id)
                        brick.elem = document.getElementById(brick.id);
                        brick.elem.style.width = brick.width + "px";
                        brick.elem.style.height = brick.height + "px";
                        brick.elem.style.background = brick.color;
                        brick.elem.style.left = brick.x + "px";
                        brick.elem.style.top = brick.y + "px"
                    })
                },
                collision(){
                    this.arr.forEach((brick, i, array) => {
                        if(ball.x + ball.width > brick.x && ball.x < brick.x + brick.width &&
                           ball.y + ball.height > brick.y && ball.y < brick.y + brick.height){
                            brick.elem.remove();
                            array.splice(i,1);
                            ball.dy *= -1
                            count.innerHTML = ++this.count + ' ' +"blocks"
                        }
                    })
                    if(this.arr.length == 0) {
                        body.style.background = 'green'
                        game.elem.style.background = 'green'
                        game.elem.innerHTML += `<p>YOU WIN</p>`
                        clearTimeout(start)
                    }
                }
            }
            init()
            let start = window.setInterval(() => ball.move(), 40)
            document.onkeydown = (e) => bar.move(e)
            function init(){
                bar.x = rand(0, game.width - bar.width)
                ball.x = bar.x + bar.width / 2 - ball.width / 2
                ball.y = game.height - bar.height - ball.height
                ball.dy *= -1
                game.create()
                ball.create()
                bar.create()
                bricks.create()              
            }
            function rand(min, max) {
                return Math.floor(Math.random() * (max - min + 1) ) + min;
            }
        </script>
    </body>
</html>